<!DOCTYPE html>
<html class="no-js">
  <head>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>CLion as C++ IDE With Charm++ Projects</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- theme meta -->
<meta name="theme-name" content="airspace-jekyll" />

<!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

<!-- CSS -->
<link rel="stylesheet" href="/css/owl.carousel.css" />
<link rel="stylesheet" href="/css/bootstrap.min.css" />
<link rel="stylesheet" href="/css/font-awesome.min.css" />
<link rel="stylesheet" href="/css/airspace.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="stylesheet" href="/css/ionicons.min.css" />
<link rel="stylesheet" href="/css/animate.css" />
<link rel="stylesheet" href="/css/responsive.css" />
<link rel="stylesheet" href="/css/syntax.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"  integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.0/css/academicons.min.css" integrity="sha512-W4yqoT1+8NLkinBLBZko+dFB2ZbHsYLDdr50VElllRcNt2Q4/GSs6u71UHKxB7S6JEMCp5Ve4xjh3eGQl/HRvg==" crossorigin="anonymous">

<!-- Js -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/plugins.js"></script>
<script src="/js/min/waypoints.min.js"></script>
<script src="/js/jquery.counterup.js"></script>
<script type="text/javascript"
src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">

<!-- scale size of the font -->
MathJax.Hub.Config({
"HTML-CSS": { scale: 90}
});

<!-- Some markdown fixes from http://cwoebker.com/posts/latex-math-magic -->
MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
});
MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });

</script>


<script src="/js/main.js"></script>

<!--
/*
 * Airspace
 * Ported to Jekyll by Andrew Lee
 * https://github.com/ndrewtl/airspace-jekyll
 * Designed and Developed by ThemeFisher
 * https://themefisher.com/
 *
 */
-->


  </head>
  <body>


    <!-- Header Start -->
<header>
<div class="container">
  <div class="row">
    <div class="col-md-12">
      <!-- header Nav Start -->
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <!-- Brand and toggle get grouped for better mobile display -->
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <!-- <a class="navbar-brand" href="index.html">
                 <img src="/img/logo.png" alt="Logo">
                 </a> -->

          <ul class="nav navbar-icons">
          <!-- Some hack to get the site title in the header -->
          <a href="/"><font size="6">Nils Deppe</font></a>&nbsp;&nbsp;&nbsp;&nbsp;
          
          <a href="/assets/pdfs/cv.pdf" target="_blank" title="CV"><i class="ai ai-cv ai-2x"></i></a>
          
          
          <a href="https://arxiv.org/search/?query=Deppe%2C+Nils&searchtype=author&abstracts=show&order=-announced_date_first&size=200" target="_blank" title="arXiv"><i class="ai ai-arxiv ai-2x"></i></a>
          
          
          <a href="https://github.com/nilsdeppe" target="_blank" title="GitHub"><i class="fab fa-github fa-2x"></i></a>
          
          <!-- 
               <a href="https://bitbucket.com/ndeppe" target="_blank" title="BitBucket"><i class="fab fa-bitbucket fa-2x"></i></a>
                -->
          
          <a href="https://www.linkedin.com/in/nilsdeppe" target="_blank" title="LinkedIn"><i class="fab fa-linkedin fa-2x"></i></a>
          
          </ul>
          </div>
          <!-- Collect the nav links, forms, and other content for toggling -->
          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav navbar-right">
                  <li><a href="/">Home</a></li>
                  <li><a href="/blog">Blog</a></li>
                  <!-- <li><a href="/work">Research</a></li> -->
              </ul>
          </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
      </nav>
    </div>
  </div>
</div>
</header><!-- header close -->



    <div class="post">
  <!-- Wrapper Start -->
  <section id="intro" style="border: 1px dotted #ddd;">
    <div class="container">
      <div class="row">
        <div>
          <div class="block">
            <h1>CLion as C++ IDE With Charm++ Projects</h1>
            <div class="post-info-wrapper">
              <p class="italic">By <span class="bold"></span> on <span class="bold">January 14, 2017</span></p>
            </div>
            <hr />
            <p><p>A while ago I wrote a <a href="/posts/emacs-c++-ide">post</a>
on using Emacs as a C++ IDE. That setup seems
to work really well for small to medium sized projects that don’t use
certain libraries. However, I’ve found that the code completion is not
always as consistent and good as I would like. After listening to a
<a href="http://cppcast.com/2016/06/anastasia-kazakova/">CppCast</a> interview with Anastasia Kazakova I decided to try
<a href="https://www.jetbrains.com/clion/specials/clion/clion.html?&amp;gclid=Cj0KEQjw_9-9BRCqpZeZhLeOg68BEiQAOviWAs-q4ChSK0G-TnqehxOk13WbDplaR8PoLSEh7W_oWKoaAm_v8P8HAQ&amp;gclsrc=aw.ds.ds&amp;dclid=CNTekdOw0M4CFcZBNwodTJsMWw">CLion</a> out as an IDE. Being a loyal Emacs user I was quite
skeptical initially but
always longed for a really well-developed and smooth workflow,
something that CLion promised.</p>

<p>After experimenting with CLion for maybe 30 minutes I wanted to give
it a test-drive on a large project I’m working on that leverages
Charm++ for parallelization. Charm++ is actually part of the reason
the Emacs setup doesn’t work as well as I’d like. It adds a lot of
code that Emacs tries to do code completion on and either I haven’t
found the right settings or the plugins just are not quite up to the
task. As it often happens when starting to use a new IDE with an
existing large project, nothing worked out of the box. I quickly
managed to get
the code to compile. Playing around with more toy code allowed me to
better understand how CLion’s CMake options worked and soon
thereafter I was compiling the project with CLion. Great, right?</p>

<p>Unfortunately, even though CLion had no troubles compiling the
project it failed with strange “CMake Project” errors. Specifically,
<code class="language-plaintext highlighter-rouge">charmc</code>, the Charm++ compiler wrapper, would fail with the error
<code class="language-plaintext highlighter-rouge">file with unrecognized extension ...</code>. This
was very puzzling since I could build the project just
fine. A Google search yielded nothing useful so I decided to solve the
problem myself. Searching through the <code class="language-plaintext highlighter-rouge">charmc</code> script I found the line
that gives the error and then started experimenting with what changes
would result in successful code compilation and also successful
code completion in CLion. Ultimately I found there were two changes
needed
to <code class="language-plaintext highlighter-rouge">charmc</code>.  Note that the funny indentation in the following is
because of the tabs in the <code class="language-plaintext highlighter-rouge">charmc</code> script. First I had to replace the
lines (approximately line 1350)</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">	<span class="k">*</span>.C|<span class="k">*</span>.cc|<span class="k">*</span>.cxx|<span class="k">*</span>.cpp|<span class="k">*</span>.c++|<span class="k">*</span>.cu<span class="o">)</span>
		Do <span class="nv">$CMK_CXX</span> <span class="nt">-I</span><span class="nv">$CHARMINC</span> <span class="nv">$CMK_SYSINC</span> <span class="nv">$OPTS_CPP_INTERNAL</span> <span class="nv">$OPTS_CPP</span> <span class="nv">$OPTS_CXX</span> <span class="nt">-c</span> <span class="nv">$FILE</span> <span class="nv">$DESTO</span></code></pre></figure>

<p>with</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">	<span class="k">*</span>.C|<span class="k">*</span>.cc|<span class="k">*</span>.cxx|<span class="k">*</span>.cpp|<span class="k">*</span>.c++|<span class="k">*</span>.cu<span class="o">)</span>
		<span class="c"># Do $CMK_CXX -I$CHARMINC $CMK_SYSINC $OPTS_CPP_INTERNAL $OPTS_CPP $OPTS_CXX -c $FILE $DESTO</span>
		<span class="nb">exec</span> <span class="nv">$CMK_CXX</span> <span class="nt">-I</span><span class="nv">$CHARMINC</span> <span class="nv">$CMK_SYSINC</span> <span class="nv">$OPTS_CPP_INTERNAL</span> <span class="nv">$OPTS_CPP</span> <span class="nv">$OPTS_CXX</span> <span class="nt">-c</span> <span class="nv">$FILE</span> <span class="nv">$DESTO</span>
		<span class="nb">exit </span>0</code></pre></figure>

<p>This was needed for dealing with code completion and CLion not finding
some of the header files.
Next, to deal with the actual “file extension unrecognized” errors
I changed the lines (approximately line 1380)</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">	<span class="k">*</span><span class="o">)</span>
		Abort <span class="s2">"file with unrecognized extension </span><span class="nv">$FILE</span><span class="s2">"</span>
	<span class="k">esac</span></code></pre></figure>

<p>to</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">	<span class="k">*</span><span class="o">)</span>
		<span class="nb">exec </span>g++ <span class="nt">-I</span><span class="nv">$CHARMINC</span> <span class="nv">$CMK_SYSINC</span> <span class="nv">$OPTS_CPP_INTERNAL</span> <span class="nv">$OPTS_CPP</span> <span class="nv">$OPTS_CXX</span> <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
		<span class="nb">exit </span>0
		<span class="c"># Abort "file with unrecognized extension $FILE"</span>
	<span class="k">esac</span></code></pre></figure>

<p>These changes appear to be sufficient for projects that only use
C++. However, if your project also compiles C or Fortran code you may
need to change more of the <code class="language-plaintext highlighter-rouge">charmc</code> script. Hopefully the above will
guide you on your way to making those changes.</p>

<p>Next I had to get CLion’s code completion and analysis toolsto find
the Charm++ headers. For this you will need to explicitly add the
<code class="language-plaintext highlighter-rouge">-I/path/to/charm/include</code> flag to the <code class="language-plaintext highlighter-rouge">CMAKE_CXX_FLAGS</code> variable.
This can be done by adding the following to your CMake setup,</p>

<figure class="highlight"><pre><code class="language-cmake" data-lang="cmake"><span class="nb">set</span><span class="p">(</span>CMAKE_CXX_FLAGS <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CXX_FLAGS</span><span class="si">}</span><span class="s2"> -I/path/to/charm/include"</span><span class="p">)</span></code></pre></figure>

<p>Now we are most of the way to where we want to be, but unfortunately
CLion still will not recognize C++11, even
if you have set the flag <code class="language-plaintext highlighter-rouge">-std=c++11</code> (at least using Clang on
macOS). To deal with this I added</p>

<figure class="highlight"><pre><code class="language-cmake" data-lang="cmake"><span class="nb">set</span><span class="p">(</span>CMAKE_CXX_FLAGS <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CXX_FLAGS</span><span class="si">}</span><span class="s2"> -std=c++11 -stdlib=libc++"</span><span class="p">)</span></code></pre></figure>

<p>to the CMake file. Note that if you do not have <code class="language-plaintext highlighter-rouge">libc++</code> installed on
your system you can omit the <code class="language-plaintext highlighter-rouge">-stdlib=libc++</code> flag. On macOS <code class="language-plaintext highlighter-rouge">libc++</code>
is always installed.
Finally, on macOS it was also necessary to add</p>

<figure class="highlight"><pre><code class="language-cmake" data-lang="cmake"><span class="nb">set</span><span class="p">(</span>CMAKE_CXX_FLAGS <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CXX_FLAGS</span><span class="si">}</span><span class="s2"> -mmacosx-version-min=10.7"</span><span class="p">)</span></code></pre></figure>

<p>to the CMake file.</p>

<p>With these changes I was able to successfully compile the code base
and also have CLion’s code completion and code analysis tools work
correctly. At some point I may submit patches to the <code class="language-plaintext highlighter-rouge">charmc</code> script
back to the Charm++ project, but for now this is enough to allow me to
have the workflow I’ve always wanted.</p>

</p>
          </div>
        </div><!-- .col-md-7 close -->
      </div>
    </div>
  </section>
</div>
<p class="center-text" style="padding: 30px;">
  <a href="/blog">Back to blog</a>
</p>


<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'nilsdeppe'; // required: replace example with your forum shortname
        // var disqus_developer = 1; // Comment out when the site is live
        var disqus_identifier = "/posts/clion-ide-charm";

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>












    <!-- footer Start -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="footer-manu">
          <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/blog">Blog</a></li>
            <li><a href="/contact">Contact</a></li>
            
            <li><a href="/assets/pdfs/cv.pdf" target="_blank" title="CV"><i class="ai ai-cv ai-1x"></i></a></li>
            
            
            <li><a href="https://orcid.org/0000-0003-4557-4115" target="_blank" title="ORCID"><i class="ai ai-orcid ai-1x"></i></a></li>
            
            
            <li><a href="https://arxiv.org/search/?query=Deppe%2C+Nils&searchtype=author&abstracts=show&order=-announced_date_first&size=200" target="_blank" title="arXiv"><i class="ai ai-arxiv ai-1x"></i></a></li>
            
            
            <li><a href="https://github.com/nilsdeppe" target="_blank" title="GitHub"><i class="fab fa-github fa-1x"></i></a></li>
            
            
            <li><a href="https://www.linkedin.com/in/nilsdeppe" target="_blank" title="LinkedIn"><i class="fab fa-linkedin fa-1x"></i></a></li>
            
          </ul>
        </div>
        <p>Copyright &copy; Design &amp; Developed by <a href="http://www.themefisher.com">Themefisher</a>. All rights reserved.</p>
      </div>
    </div>
  </div>
</footer>


    </body>
</html>
